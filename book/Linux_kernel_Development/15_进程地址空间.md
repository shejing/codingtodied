# 进程地址空间
内核使用**内存描述符**结构体表示进程的地址空间。**mm_struct**
内存描述符通过维护内存区域(VMA)链表和红黑树，来维护进程地址空间。
+ mm_user: 表示本进程中所有的线程数
+ mm_count: 表示引用此描述符的进程数
+ pgd: 页表，虚拟地址到物理内存地址的映射
+ 该结构体同时保存了代码段，数据段，堆栈等的地址。

## 分配内存描述符
进程描述符中的mm字段保持了该进程的内存描述符。每一个进程都有唯一的内存描述符，线程共享同一个内存描述符，因为线程共享地址空间。在调用fork()时，fork()函数利用copy_mm()函数复制父进程的内存描述符。
当进程退出时，内核会调用exit_mm()，该函数减少引用计数，如果mm_count == 0, 则将mm_struct归还给缓存。

## 内核线程
内核线程没有进程地址空间，也没有相关的内存描述符。但是当内核线程访问内核内存时，仍然需要页表等信息，为了避免浪费，内核线程将直接使用前一个进程的内存描述符。

## 虚拟内存区域
**vm_area_struct**描述了地址空间中连续区间上一个独立的内存范围，每个内存区域有一至的属性。
代码段，数据段，堆栈等都是有不同属性的虚拟内存区域。
**mm_struct**中使用链表来遍历每个内存区域，使用红黑树来定位某个地址的内存区域

## 创建地址空间
**mmap()** : 将文件映射到一段地址空间，并返回地址区间的首地址。如果文件参数是NULL，该情况就是**匿名映射**。
**munmap()** : 删除指定的地址空间

## 页表
将虚拟地址映射到物理地址，多级页表相比一级页表更加节省空间。
TLB，翻译后缓冲器，用来缓存翻译过的映射。
页表存储在**mm_struct**中。
